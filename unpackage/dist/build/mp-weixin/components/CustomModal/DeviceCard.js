"use strict";const e=require("../../common/vendor.js"),t={data:()=>({warteringimageSrc:"../../static/deviceCard/startwartering.png",connectStatusScr:"../../static/deviceCard/wifi_disconnect.png",connectStatus:"离线",deviceUrl:"https://mp-0c7f093e-1151-46a0-9859-1d831d548ad6.cdn.bspapp.com/uniapp/device.png",deletePicUrl:"https://mp-0c7f093e-1151-46a0-9859-1d831d548ad6.cdn.bspapp.com/delte-pic.png",buttonEnabled:!0,buttonText:"开始浇花"}),props:{device:{type:Object,required:!0,default:()=>({deviceSN:"",deviceName:"",devicePlace:""})}},mounted(){this.startDeviceConnectionStatusCheck()},methods:{onWaterring(e){this.sendTcpMessage(e,"on"),this.warteringimageSrc="../../static/deviceCard/stopwartering.png",this.buttonText="正在浇花",this.buttonEnabled=!1,setTimeout((()=>{this.stopWaterring(e)}),1e4)},stopWaterring(e){let t=0;const c=setInterval((()=>{this.sendTcpMessage(e,"off"),t++,2===t&&(clearInterval(c),this.warteringimageSrc="../../static/deviceCard/startwartering.png",this.buttonText="开始浇花",this.buttonEnabled=!0)}),300)},sendTcpMessage(t,c){e.index.request({url:"https://apis.bemfa.com/va/postmsg",method:"POST",data:{uid:"c2421290f7d14fa38251e5f77aac931a",topic:this.device.deviceSN,type:3,msg:c},header:{"content-type":"application/x-www-form-urlencoded"},success:e=>{console.log("发送成功：",c)}})},deleteDevice(){console.log("delete",this.device);const t=this.device;e.index.showModal({title:"删除设备",content:"是否确认要删除该设备？",success:function(c){c.confirm?(console.log("用户点击确定",t),e.Ws.callFunction({name:"deleteDevice",data:{device:t}}).then((c=>{0!=c.result.code?console.log("deleteDevice Fail，",c.result.msg):e.index.$emit("deleteDevice",t.deviceSN)}))):c.cancel&&console.log("用户点击取消")}})},async getDeviceConnectionStatus(){try{e.index.request({url:"https://apis.bemfa.com/va/online",method:"GET",data:{uid:"c2421290f7d14fa38251e5f77aac931a",topic:this.device.deviceSN,type:3},header:{"content-type":"application/x-www-form-urlencoded"},success:e=>{0==e.data.code&&(1==e.data.data?(this.connectStatusScr="../../static/deviceCard/connect.png",this.connectStatus="在线"):(this.connectStatusScr="../../static/deviceCard/wifi_disconnect.png",this.connectStatus="离线"))}})}catch(t){console.error("获取设备连接状态失败：",t),e.index.showToast({title:"获取设备连接状态失败",icon:"error"})}},startDeviceConnectionStatusCheck(){this.getDeviceConnectionStatus().then((()=>{setTimeout(this.startDeviceConnectionStatusCheck,5e3)})).catch((e=>{console.error("获取设备连接状态失败:",e),setTimeout(this.startDeviceConnectionStatusCheck,5e3)}))}}};const c=e._export_sfc(t,[["render",function(t,c,n,i,a,s){return{a:a.deviceUrl,b:e.t(n.device.deviceSN),c:e.t(n.device.deviceName),d:e.t(n.device.devicePlace),e:a.connectStatusScr,f:e.t(a.connectStatus),g:a.warteringimageSrc,h:e.o((e=>s.onWaterring(n.device))),i:e.o((e=>s.stopWaterring(n.device))),j:!a.buttonEnabled,k:e.n(1==a.buttonEnabled?"":"img_notClick"),l:e.t(a.buttonText),m:a.deletePicUrl,n:e.o(((...e)=>s.deleteDevice&&s.deleteDevice(...e)))}}]]);wx.createComponent(c);
