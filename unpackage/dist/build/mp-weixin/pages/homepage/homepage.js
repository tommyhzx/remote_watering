"use strict";const e=require("../../common/vendor.js"),a={components:{InputModal:()=>"../../components/CustomModal/InputModal.js",DeviceCard:()=>"../../components/CustomModal/DeviceCard.js"},props:{},data:()=>({deviceSN:[],devices:[],showAddDeviceBtn:!0,avatarUrl:getApp().globalData.userAvater||"/static/pic/defaultAvatar.png",userName:getApp().globalData.username,addPicUrl:"/static/homepage/add_device.png",peiwangUrl:"https://mp-0c7f093e-1151-46a0-9859-1d831d548ad6.cdn.bspapp.com/peiwang.png",addBtnUrl:"https://mp-0c7f093e-1151-46a0-9859-1d831d548ad6.cdn.bspapp.com/add-btn.png"}),computed:{showAddDeviceBtn(){return 0===this.devices.length}},onReady(){},onLoad(a){e.index.$on("LoginID",(a=>{e.Ws.callFunction({name:"getUserDevices",data:{deviceUser:a}}).then((e=>{0==e.result.code&&(console.log("查询用户设备为：",e),this.devices=e.result.data)}))})),e.index.$on("addDevice",(a=>{if(this.deviceSN.includes(a.deviceSN))e.index.showToast({title:"设备已存在"});else{const d={deviceSN:a.deviceSN,deviceName:a.deviceName,devicePlace:a.devicePlace,deviceUser:getApp().globalData.WxOpenId};e.Ws.callFunction({name:"creatDevice",data:{device:d}}).then((d=>{0==d.result.code?(this.devices.push({deviceSN:a.deviceSN,deviceName:a.deviceName,devicePlace:a.devicePlace}),this.deviceSN.push(a.deviceSN)):(console.log("creatDevice Fail，",d.result.msg),e.index.showToast({title:d.result.msg}))}))}})),e.index.$on("deleteDevice",(e=>{console.log("删除设备列表",e);const a=e,d=this.devices.filter((e=>e.deviceSN!==a));this.devices=d,console.log("设备列表",this.devices)})),e.index.$on("saveUserInfo",(e=>{this.avatarUrl=e.avatarUrl,this.userName=getApp().globalData.username}))},onShow(){e.index.hideHomeButton()},onUnload(){e.index.$off("addDevice")},methods:{addDevice(){e.index.navigateTo({url:"/pages/addDevice/addDevice"})},gotoAbout(){e.index.navigateTo({url:"/pages/about/about"})},peiwang(){e.index.navigateToMiniProgram({appId:"wxc8125e5b4219faab",path:"pages/ap/ap",envVersion:"release",success(e){console.log("跳转成功",e)},fail(e){console.error("跳转失败",e)}})}}};if(!Array){e.resolveComponent("DeviceCard")()}const d=e._export_sfc(a,[["render",function(a,d,i,t,o,c){return e.e({a:o.addPicUrl,b:e.o(((...e)=>c.addDevice&&c.addDevice(...e))),c:o.peiwangUrl,d:e.o(((...e)=>c.peiwang&&c.peiwang(...e))),e:e.t(o.userName),f:o.avatarUrl,g:e.o(((...e)=>c.gotoAbout&&c.gotoAbout(...e))),h:e.f(o.devices,((a,d,i)=>({a:"27eb7476-0-"+i,b:e.p({device:a}),c:d}))),i:c.showAddDeviceBtn},c.showAddDeviceBtn?{j:o.addBtnUrl,k:e.o(((...e)=>c.addDevice&&c.addDevice(...e)))}:{})}]]);wx.createPage(d);
