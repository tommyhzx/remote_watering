"use strict";const e=require("../../common/vendor.js"),d={components:{InputModal:()=>"../../components/CustomModal/InputModal.js",DeviceCard:()=>"../../components/CustomModal/DeviceCard.js"},props:{},data:()=>({modalVisible:!1,deviceSN:[],defaultDevice:{deviceSN:"",deviceName:"默认设备",devicePlace:"设备位置"},devices:[],showAddDeviceBtn:!0,User:"",avatarUrl:getApp().globalData.userAvater||"/static/pic/defaultAvatar.png"}),computed:{showAddDeviceBtn(){return 0===this.devices.length}},onReady(){},onLoad(d){e.index.$on("addDevice",(d=>{if(this.deviceSN.includes(d.deviceSN))e.index.showToast({title:"设备已存在"});else{const i={deviceSN:d.deviceSN,deviceName:d.deviceName,devicePlace:d.devicePlace,deviceUser:getApp().globalData.WxOpenId};e.Ws.callFunction({name:"creatDevice",data:{device:i}}).then((i=>{0==i.result.code?(this.devices.push({deviceSN:d.deviceSN,deviceName:d.deviceName,devicePlace:d.devicePlace}),this.deviceSN.push(d.deviceSN)):(console.log("creatDevice Fail，",i.result.msg),e.index.showToast({title:i.result.msg}))}))}})),e.index.$on("LoginID",(d=>{console.log("监听到事件来自 update ，LoginID 为："+d),this.User=d,e.Ws.callFunction({name:"getUserDevices",data:{deviceUser:d}}).then((e=>{0==e.result.code&&(console.log("查询用户设备为：",e),this.devices=e.result.data)}))})),e.index.$on("deleteDevice",(e=>{console.log("删除设备列表",e);const d=e,i=this.devices.filter((e=>e.deviceSN!==d));this.devices=i,console.log("设备列表",this.devices)})),e.index.$on("saveUserInfo",(e=>{this.avatarUrl=e.userAvater}))},onUnload(){e.index.$off("addDevice")},methods:{addDevice(){e.index.navigateTo({url:"/pages/addDevice/addDevice"})},gotoAbout(){e.index.navigateTo({url:"/pages/about/about"})}}};if(!Array){e.resolveComponent("DeviceCard")()}const i=e._export_sfc(d,[["render",function(d,i,c,o,t,a){return e.e({a:e.o(((...e)=>a.addDevice&&a.addDevice(...e))),b:t.avatarUrl,c:e.o(((...e)=>a.gotoAbout&&a.gotoAbout(...e))),d:e.f(t.devices,((d,i,c)=>({a:"27eb7476-0-"+c,b:e.p({device:d}),c:i}))),e:a.showAddDeviceBtn},a.showAddDeviceBtn?{f:e.o(((...e)=>a.addDevice&&a.addDevice(...e)))}:{})}]]);wx.createPage(i);
